<?xml version="1.0"?>
<!--
  =======================================================================
  Build instruction of tracker, Generated by SilkPage.
  To build the site for preview, type in 'ant preview' on the command line
  For Online documentation, http://silkpage.markupware.com/docs/
  =======================================================================
-->

<project name="tracker" default="preview">
<property file="build.properties"/>
 <!--
       ===================================================================
       preview        		     
       ===================================================================
  -->
<target name="preview" depends="cleanOutput"
   description="generates and installs a local copy for preview">
	<echoproperties></echoproperties>
   <ant antfile="${silkpage.home.dir}/src/xml/build/tasks.xml"
     dir="${silkpage.home.dir}" inheritAll="false" target="website">
     <property file="build.properties"/>
   </ant>
	<antcall target="update.html" />
</target>
 <!--
       ===================================================================
       publish        		     
       ===================================================================
  -->
<target name="publish" depends="metadata,preview"
   description="publishes a copy of your website online">
   <ant antfile="${silkpage.home.dir}/src/xml/build/tasks.xml"
     dir="${silkpage.home.dir}" inheritAll="false" target="uploadWebsite">
     <property file="build.properties"/>
   </ant>
</target>

 <!--
       ===================================================================
       metadata
       ===================================================================
  -->
<target name="metadata"
        description="generates RDF metadata for each XML source">
  <ant antfile="${silkpage.home.dir}/src/xml/build/tasks.xml"
       dir="${silkpage.home.dir}" inheritAll="false" target="websiteMetadata">
     <property file="build.properties"/>
   </ant>
</target>
	
	<!-- ================================= 
          target: deploy.to.local.repo.dir              
         ================================= -->
    <target name="deploy.to.local.repo.dir" depends="preview, cleanRepo" description="Deploy the site to the localRepoDir">
    	<tstamp>
    	    <format property="TODAY_DATE" pattern="d-MMMM-yyyy" />
    	</tstamp>
    	<echo>toDir=${local.dir.to.sync}  fromDir=${dist.dir}</echo>
    	
    	<copy todir="${local.dir.to.sync}">
    	    <fileset dir="${dist.dir}"/>
    	 </copy>
    	
    </target>

	
	<!-- - - - - - - - - - - - - - - - - - 
          target: cleanOutput                      
         - - - - - - - - - - - - - - - - - -->
    <target name="cleanOutput">
            <delete dir="${default.temp.dir}"/>
    </target>
	
	<!-- - - - - - - - - - - - - - - - - - 
	          target: cleanRepo      
	          <fileset dir="${user.dir}/s3" excludes="Tracker/"/>               
	 	- - - - - - - - - - - - - - - - - -->
	 <target name="cleanRepo">
	 	<echoproperties></echoproperties>
		<delete verbose="true" includeemptydirs="true">
			<fileset dir="${local.dir.to.sync}">
			    <exclude name="Tracker/**"/>
			</fileset>
		</delete>
	 </target>

<!-- - - - - - - - - - - - - - - - - - 
          target: update.html  
          param product.version.file
          param release.win.size
		  param release.lin.size
		  called by preview
         - - - - - - - - - - - - - - - - - -->
    <target name="update.html">
		<loadproperties srcFile="${product.version.file}"/>
    	<!--
    	${product.version.file} will set trackerVersion
    	          property with a value like:0.3.5.v200908211437
    	 -->
    	  
     	<property name="release.title" value="Tracker Business Intelligence Toolkit Version/BuildId ${trackerVersion}"/>

		<!-- 
	    Todo Get the length of the archives from the files themselves.
	    	but have to figure out which file is which
	   		<length file="${win.build.file}" property="release.win.size"/>
			<length file="${lin.build.file}" property="release.lin.size" />
		For now just get them from the properties file
		release.win.size=50.5M
   		release.lin.size=50.2M  
		-->
		<property name="target.downloads.file" location="${default.temp.dir}/tracker.verticon.com/downloads/index.html"/>
		
		<replace 
			    file="${target.downloads.file}">
			<replacefilter 
			    token="@release.version@" 
			    value="${trackerVersion}"/>
			<replacefilter 
				token="@release.title@" 
				value="${release.title}"/>
			<replacefilter 
				token="@release.win.size@" 
				value="${release.win.size}"/>
			<replacefilter 
				token="@release.lin.size@" 
				value="${release.lin.size}"/>
			<replacefilter 
				token="@release.win64.size@" 
				value="${release.win64.size}"/>
			<replacefilter 
				token="@release.lin64.size@" 
				value="${release.lin64.size}"/>
		</replace>
    </target>

</project>
